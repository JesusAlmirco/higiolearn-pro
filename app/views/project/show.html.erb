<div class="row">
    <div class="col-lg-12 text-center">
        <%= content_tag :h3, @project.name, class: "text-title" %>
        <img class="rounded-circle avatar-large" src="https://coderealprojects.com/assets/leotrieu-f7211023c164aff27c0f6590e6b4c32a.jpg" alt="JesusAlmirco" />
        <p>Jesus Almirco</p>
    </div>
</div>
<br>

<!-- PROJECT DETAIL -->
<div class="row">
    <!-- LEFT CARD -->
    <div class="col-md-3" data-turbolinks="false">
        
        <div class="card mb-4 shadow-sm">
            <% if !@joined %>
                <div class="card-header text-center">
                    <%= content_tag :h1, @project.price == 0? "Free" : "$ #{@project.price}", class: "my-0 font-weight-normal" %>
                </div>
                <div class="card-body text-center">
                    
                    <h6 class="card-text"><i class="far fa-file-code"></i> Full Source Code</h6>
                    <h6 class="card-text"><i class="far fa-comments"></i> Discussion Support</h6>
                    <br>
                    <% if user_signed_in? %>
                        <%= form_tag free_path do %>
                            <%= hidden_field_tag 'project_id', @project.id %>
                            <button type="submit" class="btn btn-form">Start Project</button>
                        <% end %>
                    <% else %>
                        <%= link_to new_user_session_path do  %>
                            <button type="submit" class="btn btn-form">Start Project</button>
                        <% end %>
                    <% end %>

                </div>
            <% else %>
                <div class="card-body text-center">
                    <%= image_tag avatar_url(current_user), class: "img-circle avatar-medium" %><hr>
                    <span>
                        Welcome to this Project 
                    </span>
                    <%= content_tag :h5, truncate(current_user.fullname, :length => 17, :separator => ' ') %> <br>
                    <%= image_tag "party.svg", class: "img-circle avatar-medium" %> <br> <br>
                    <div id="average_rating"></div> 
                    <span> ( <%= @reviews.count %> <%= @reviews.count > 1? "Reviews" : "Review" %> )</span> <br><br>
                    <!--Review Modal-->
                    <%= render 'reviews/index' %>

                </div>
            <% end %>
        </div>
    </div>
    <!-- /LEFT CARD -->

    <!-- RIGHT CARD -->
    
    <div class="col-md-9">
        <div class="card">
            <div class="card-body">
                <ul class="nav nav-tabs justify-content-center" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active h-5" data-toggle="tab" href="#about" role="tab"><i class="fas fa-comment-dots"></i> OVERVIEW </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link h-5" data-toggle="tab" href="#learn_path" role="tab"><i class="fas fa-road"></i> LEARN PATH </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link h-5" data-toggle="tab" href="#discussion" role="tab"> REVIEWS <i class="fas fa-star"></i></a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="about" class="tab-pane active" data-turbolinks="false" role="tabpanel">
                        <p class="text-left p-4">
                            <%=  markdown(@project.content) %>
                        </p>
                    </div>

                    <div id="learn_path" class="tab-pane p-4" data-turbolinks="false" role="tabpanel">
                        <% @tasks.each do |task| %>
                
                            <% if task.header %>
                                <!--TASK HEADER-->
                                <h5 class="card-title mt-4"><i class="fas fa-graduation-cap"></i>&nbsp; <%= task.title %></h5>
                                <!--/TASK HEADER-->
                            <% else %>
                                <!--TASK ITEMS-->
                                <ul class="list-group list-group-flush">
                                    <%= link_to [task.project, task], class: "list-group-item task-item" do %>  <!--  --->
                                        <% if !@joined %>
                                            <span><i class="fas fa-lock"></i>&nbsp; <%= task.title %></span> 
                                        <% else %>
                                            <%= task.title %></span> 
                                        <% end %>
                                    <% end %>
                                </ul>
                                <!--/TASK ITEMS-->
                            <% end %>
                        
                        <% end %>
                    </div>
                    <div id="discussion" class="tab-pane" data-turbolinks="false" role="tabpanel">
                        <div class="mt-4 p-4">
                            <%= render 'reviews/show' %>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    
    <!-- /RIGHT CARD -->
</div>
<!-- /PROJECT DETAIL -->

<!--Raty script-->
<script>
    $('#average_rating').raty({
        path: '/assets/raty-js/lib/images',
        readOnly: true,
        score: <%= @project.average_rating %>
    });
</script>